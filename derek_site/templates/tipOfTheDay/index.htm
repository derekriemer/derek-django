{% extends "tipOfTheDay/base.htm" %}
{% comment %}
	This file Copyright (C) Derek Riemer, 2016
	This file is part of my personal website.

	my personal website is free software: you can redistribute it and/or modify
	it under the terms of the GNU Affero General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	The code of my personal website is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with my personal website.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}

{% block title %}Tips List{% endblock %}
{% block other %}
<script>
	function deleteSend(pk){
		$.ajaxSetup({
			beforeSend: function(xhr, settings) {
				xhr.setRequestHeader("X-CSRFToken", "{{csrf_token}}"); //Hard coding it here is perfectly fine.
			}
		});
		$.post("delete",
		{
			pk :pk
		},
		function(data, status){
			console.log(status);
			if(status == "success"){
				alert(data);
				document.getElementById("row"+pk).remove();
			}
		});
}
function deleteConfirm(title, pk){
	var i = confirm("Are you really sure you want to delete "+title+"? This action cannot be undone.");
	if(i)
		deleteSend(pk);
	else
		return;
}
</script>
{% endblock %}
{% block header %}Tips List{% endblock %}
{% block main %}
<div id="buttons" class="row">
<div class="col-xs-1">
<a class="col-xs-1 btn btn-default" role="button" href="{%url 'tipOfTheDay:tip' %}"> Add a Tip!</a>
</div>
<div class="col-xs-1"></div>
<a target ="_blank" class="col-xs-1 btn btn-default" role="button" href="{%url 'tipOfTheDay:json' %}"> View the JSON in a new tab!</a>
</div>
<div id="list" class="row">
<table>
<caption> Tips and there attributes.</caption>
<thead>
<tr>
<th scope="col"> Title</th>
<th scope="col"> Levels</th>
<th scope="col"> Weight</th>
<th scope="col"> First Fifty Words of Text</th>
</tr>
</thead>
<tbody>
{% for i in tips %}
<tr id="row{{i.id}}">
<th scope="row" id="tbl-{{i.id}}">{{i.title}}</th>
<td>{{ i.getLevelList|join:", " }}</td>
<td>{{i.weight}}</td>
<td>{{i.getTruncatedText}}</td>
<td>
	<ul>
		<li><a class="btn btn-default" role="button" href="{% url 'tipOfTheDay:tip' %}?pk={{i.pk}}"> Edit Tip</a> </li>
		<li> <button onclick="deleteConfirm('{{i.title}}', {{i.pk}});"> Delete Tip</button></li>
	</ul>
</td>
</tr>
{% empty %}
No tips.
{% endfor %}
</tbody>
</table>
</div>
{% endblock %}
